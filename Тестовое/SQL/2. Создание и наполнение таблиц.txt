BEGIN
  FOR rec IN
    (
      SELECT
        table_name
      FROM
        all_tables
      WHERE
        owner='ADMIN'
    )
  LOOP
    EXECUTE immediate 'DROP TABLE  admin.'||rec.table_name || ' CASCADE CONSTRAINTS';
  END LOOP;
END;
/
CREATE TABLE admin.clients (
    client_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY (START WITH 6 INCREMENT BY 1) NOT NULL,
    first_name VARCHAR2(20)NOT NULL,
	last_name VARCHAR2(20)NOT NULL,
    email VARCHAR2(30)NOT NULL, 
    phone_number VARCHAR2(20)NOT NULL,
	PRIMARY KEY(client_id),
	CONSTRAINT email_unique UNIQUE (email),
	CONSTRAINT phone_unique UNIQUE (phone_number)
 );
 CREATE TABLE admin.car_status_type (
 status_id NUMBER NOT NULL,
 status_description VARCHAR2(30) NOT NULL,
 PRIMARY KEY(status_id)
 );

 CREATE TABLE admin.cars (
    car_id NUMBER GENERATED BY DEFAULT AS IDENTITY (START WITH 10 INCREMENT BY 1) NOT NULL,
    brand VARCHAR2(20)NOT NULL,
	model VARCHAR2(20)NOT NULL,
	color VARCHAR2(15) NOT NULL,
	type VARCHAR2(15) NOT NULL,
    licence_plate VARCHAR2(15)NOT NULL, 
    status NUMBER DEFAULT 1,
	rent_price NUMBER NOT NULL,
	PRIMARY KEY(car_id),
	UNIQUE(licence_plate),
	FOREIGN KEY(status) REFERENCES admin.car_status_type(status_id)
 );
 
 CREATE TABLE admin.car_occupied(
 car_id NUMBER NOT NULL,
 start_date DATE NOT NULL,
 end_date DATE NOT NULL,
 PRIMARY KEY(car_id),
 FOREIGN KEY(car_id) REFERENCES admin.cars(car_id)
 );
 
 CREATE TABLE admin.order_status (
 status_id NUMBER NOT NULL,
 status_description VARCHAR2(20),
 PRIMARY KEY(status_id)
 );
 
CREATE TABLE admin.orders (
    order_id NUMBER GENERATED BY DEFAULT AS IDENTITY (START WITH 10 INCREMENT BY 1) NOT NULL,
    car NUMBER NOT NULL,
	client NUMBER NOT NULL,
	order_status NUMBER NOT NULL,
	start_date DATE NOT NULL,
	end_date DATE NOT NULL,
	order_sum NUMBER NOT NULL,
	PRIMARY KEY(order_id),
	FOREIGN KEY(car) REFERENCES admin.cars(car_id),
	FOREIGN KEY(client) REFERENCES admin.clients(client_id),
	FOREIGN KEY(order_status) REFERENCES admin.order_status(status_id)
 );
 
 CREATE TABLE admin.car_history (
 record_id NUMBER GENERATED BY DEFAULT AS IDENTITY (START WITH 100 INCREMENT BY 1) NOT NULL,
 car_id NUMBER NOT NULL,
 car_status NUMBER NOT NULL,
 record_datetime TIMESTAMP(0) NOT NULL,
 order_id NUMBER,
 PRIMARY KEY(record_id),
 FOREIGN KEY(car_status) REFERENCES admin.car_status_type(status_id)
 );
 
 CREATE TABLE admin.order_history (
	record_id NUMBER GENERATED BY DEFAULT AS IDENTITY (START WITH 100 INCREMENT BY 1) NOT NULL,
	order_id NUMBER NOT NULL,
	car NUMBER NOT NULL,
	client NUMBER NOT NULL,
	order_status NUMBER NOT NULL,
	start_date DATE NOT NULL,
	end_date DATE NOT NULL,
	order_sum NUMBER NOT NULL,
	record_datetime TIMESTAMP(0) NOT NULL,
 PRIMARY KEY(record_id),
 FOREIGN KEY(order_status) REFERENCES admin.order_status(status_id)
 );
 INSERT ALL 
INTO admin.clients(client_id,first_name,last_name,email,phone_number)
VALUES(1,'Sergey', 'Plotnikov','serg@yandex.ru','89001234321')
INTO admin.clients(client_id,first_name,last_name,email,phone_number)
VALUES(2,'Alex', 'Aleksandrov','alex@yandex.ru','89001234322')
INTO admin.clients(client_id,first_name,last_name,email,phone_number)
VALUES(3,'Ivan', 'Ivanov','ivan@yandex.ru','89001234323')
INTO admin.clients(client_id,first_name,last_name,email,phone_number)
VALUES(4,'Алексей', 'Алексеев','aleksei@yandex.ru','89001234324')
INTO admin.clients(client_id,first_name,last_name,email,phone_number)
VALUES(5,'Роман', 'Романов','roman@yandex.ru','89001234325')
INTO admin.car_status_type(status_id,status_description) VALUES(1,'FREE')
INTO admin.car_status_type(status_id,status_description) VALUES(2,'ORDERED')
INTO admin.car_status_type(status_id,status_description) VALUES(3,'MAINTENANCE')
INTO admin.car_status_type(status_id,status_description) VALUES(4,'OUT OF SERVICE/DELETED')
INTO admin.cars(car_id,brand,model,color,type,licence_plate,status,rent_price)
VALUES(1,'Hyundai','Solaris','Blue','sedan','А111АМ61',1,1000)
INTO admin.cars(car_id,brand,model,color,type,licence_plate,status,rent_price)
VALUES(2,'Hyundai','i30','Red','hatchback','C112АМ61',1,1000)
INTO admin.cars(car_id,brand,model,color,type,licence_plate,status,rent_price)
VALUES(3,'Kia','Rio','Yellow','sedan','В113АМ61',2,1000)
INTO admin.cars(car_id,brand,model,color,type,licence_plate,status,rent_price)
VALUES(4,'Kia','Seltos','White','Crossover','C114АМ61',1,1000)
INTO admin.cars(car_id,brand,model,color,type,licence_plate,status,rent_price)
VALUES(5,'Kia','Seltos','Blue','Crossover','Н115АМ61',3,1000)
INTO admin.cars(car_id,brand,model,color,type,licence_plate,status,rent_price)
VALUES(6,'Hyundai','i30','White','hatchback','C116АМ61',1,1000)
INTO admin.order_status(status_id,status_description) VALUES(1,'CREATED')
INTO admin.order_status(status_id,status_description) VALUES(2,'DECLINED')
INTO admin.order_status(status_id,status_description) VALUES(3,'IN PROGRESS')
INTO admin.order_status(status_id,status_description) VALUES(4,'CLOSED')
INTO admin.order_status(status_id,status_description) VALUES(5,'DELETED')
SELECT * FROM dual;


INSERT ALL 
INTO admin.car_history(record_id,car_id,car_status,record_datetime)
VALUES(8,1,1,CURRENT_DATE  - NUMTODSINTERVAL(6,'HOUR'))
INTO admin.car_history(record_id,car_id,car_status,record_datetime)
VALUES(9,2,1,CURRENT_DATE - NUMTODSINTERVAL(5,'HOUR') )
INTO admin.car_history(record_id,car_id,car_status,record_datetime)
VALUES(5,3,1,CURRENT_DATE- NUMTODSINTERVAL(8,'HOUR')-1 )
INTO admin.car_history(record_id,car_id,car_status,record_datetime, order_id)
VALUES(11,3,2,CURRENT_DATE- NUMTODSINTERVAL(3,'HOUR') ,3)
INTO admin.car_history(record_id,car_id,car_status,record_datetime)
VALUES(10,4,1,CURRENT_DATE- NUMTODSINTERVAL(4,'HOUR') )
INTO admin.car_history(record_id,car_id,car_status,record_datetime)
VALUES(3,5,1,CURRENT_DATE- NUMTODSINTERVAL(1,'HOUR')-3 )
INTO admin.car_history(record_id,car_id,car_status,record_datetime,order_id)
VALUES(4,5,2,CURRENT_DATE- NUMTODSINTERVAL(4,'HOUR')-2 ,2)
INTO admin.car_history(record_id,car_id,car_status,record_datetime)
VALUES(6,5,3,CURRENT_DATE- NUMTODSINTERVAL(4,'HOUR')-1 )
INTO admin.car_history(record_id,car_id,car_status,record_datetime)
VALUES(1,6,1,CURRENT_DATE- NUMTODSINTERVAL(3,'HOUR')-5 )
INTO admin.car_history(record_id,car_id,car_status,record_datetime, order_id)
VALUES(2,6,2,CURRENT_DATE- NUMTODSINTERVAL(2,'HOUR')-5 ,1)
INTO admin.car_history(record_id,car_id,car_status,record_datetime)
VALUES(7,6,1,CURRENT_DATE- NUMTODSINTERVAL(2,'HOUR')-1)
SELECT * FROM dual;

INSERT ALL 
INTO admin.orders(order_id,car,client,order_status,start_date,end_date,order_sum)
VALUES(1,6,2,4,TRUNC(CURRENT_DATE-5),TRUNC(CURRENT_DATE-1),5000)
INTO admin.orders(order_id,car,client,order_status,start_date,end_date,order_sum)
VALUES(2,5,1,4,TRUNC(CURRENT_DATE-2),TRUNC(CURRENT_DATE-2),1000)
INTO admin.orders(order_id,car,client,order_status,start_date,end_date,order_sum)
VALUES(3,3,2,3,TRUNC(CURRENT_DATE),TRUNC(CURRENT_DATE),1000)
INTO admin.orders(order_id,car,client,order_status,start_date,end_date,order_sum)
VALUES(4,4,3,2,TRUNC(CURRENT_DATE),TRUNC(CURRENT_DATE),1000)
INTO admin.orders(order_id,car,client,order_status,start_date,end_date,order_sum)
VALUES(5,1,5,1,TRUNC(CURRENT_DATE+1),TRUNC(CURRENT_DATE+2),2000)
INTO admin.orders(order_id,car,client,order_status,start_date,end_date,order_sum)
VALUES(6,2,5,2,TRUNC(CURRENT_DATE+1),TRUNC(CURRENT_DATE+2),2000)
INTO admin.orders(order_id,car,client,order_status,start_date,end_date,order_sum)
VALUES(7,6,4,1,TRUNC(CURRENT_DATE+3),TRUNC(CURRENT_DATE+3),1000)
SELECT * FROM dual;

INSERT ALL 
INTO admin.car_occupied(car_id,start_date,end_date)
VALUES(3,TRUNC(CURRENT_DATE),TRUNC(CURRENT_DATE))
INTO admin.car_occupied(car_id,start_date,end_date)
VALUES(1,TRUNC(CURRENT_DATE+1),TRUNC(CURRENT_DATE+1))
INTO admin.car_occupied(car_id,start_date,end_date)
VALUES(6,TRUNC(CURRENT_DATE+3),TRUNC(CURRENT_DATE+3))
SELECT * FROM dual;


INSERT ALL 
INTO admin.order_history(record_id,order_id, car, client, order_status,
start_date,end_date, order_sum, record_datetime)
VALUES(1,1,6,2,1,TRUNC(CURRENT_DATE-5),TRUNC(CURRENT_DATE-1),5000,CURRENT_DATE-6)
INTO admin.order_history(record_id,order_id, car, client, order_status,
start_date,end_date, order_sum, record_datetime)
VALUES(2,1,6,2,3,TRUNC(CURRENT_DATE-5),TRUNC(CURRENT_DATE-1),5000,CURRENT_DATE-5)
INTO admin.order_history(record_id,order_id, car, client, order_status,
start_date,end_date, order_sum, record_datetime)
VALUES(3,2,5,1,1,TRUNC(CURRENT_DATE-2),TRUNC(CURRENT_DATE-2),1000,CURRENT_DATE-3)
INTO admin.order_history(record_id,order_id, car, client, order_status,
start_date,end_date, order_sum, record_datetime)
VALUES(4,2,5,1,3,TRUNC(CURRENT_DATE-2),TRUNC(CURRENT_DATE-2),1000,CURRENT_DATE-2- NUMTODSINTERVAL(1,'HOUR'))
INTO admin.order_history(record_id,order_id, car, client, order_status,
start_date,end_date, order_sum, record_datetime)
VALUES(5,2,5,1,4,TRUNC(CURRENT_DATE-2),TRUNC(CURRENT_DATE)-2,1000,CURRENT_DATE-2)
INTO admin.order_history(record_id,order_id, car, client, order_status,
start_date,end_date, order_sum, record_datetime)
VALUES(6,1,6,2,4,TRUNC(CURRENT_DATE)-5,TRUNC(CURRENT_DATE)-1,5000,CURRENT_DATE-1)
INTO admin.order_history(record_id,order_id, car, client, order_status,
start_date,end_date, order_sum, record_datetime)
VALUES(7,3,3,2,1,TRUNC(CURRENT_DATE),TRUNC(CURRENT_DATE),1000,CURRENT_DATE- NUMTODSINTERVAL(8,'HOUR'))
INTO admin.order_history(record_id,order_id, car, client, order_status,
start_date,end_date, order_sum, record_datetime)
VALUES(8,3,3,2,3,TRUNC(CURRENT_DATE),TRUNC(CURRENT_DATE),1000,CURRENT_DATE- NUMTODSINTERVAL(7,'HOUR'))
INTO admin.order_history(record_id,order_id, car, client, order_status,
start_date,end_date, order_sum, record_datetime)
VALUES(9,4,4,3,1,TRUNC(CURRENT_DATE),TRUNC(CURRENT_DATE),1000,CURRENT_DATE- NUMTODSINTERVAL(6,'HOUR'))
INTO admin.order_history(record_id,order_id, car, client, order_status,
start_date,end_date, order_sum, record_datetime)
VALUES(10,4,4,3,2,TRUNC(CURRENT_DATE),TRUNC(CURRENT_DATE),1000,CURRENT_DATE- NUMTODSINTERVAL(5,'HOUR'))
INTO admin.order_history(record_id,order_id, car, client, order_status,
start_date,end_date, order_sum, record_datetime)
VALUES(11,5,1,5,1,TRUNC(CURRENT_DATE+1),TRUNC(CURRENT_DATE+2),2000,CURRENT_DATE- NUMTODSINTERVAL(4,'HOUR'))
INTO admin.order_history(record_id,order_id, car, client, order_status,
start_date,end_date, order_sum, record_datetime)
VALUES(12,6,2,5,1,TRUNC(CURRENT_DATE+1),TRUNC(CURRENT_DATE+2),2000,CURRENT_DATE - NUMTODSINTERVAL(4,'HOUR'))
INTO admin.order_history(record_id,order_id, car, client, order_status,
start_date,end_date, order_sum, record_datetime)
VALUES(13,6,2,5,2,TRUNC(CURRENT_DATE+1),TRUNC(CURRENT_DATE+2),2000,CURRENT_DATE- NUMTODSINTERVAL(1,'HOUR'))
INTO admin.order_history(record_id,order_id, car, client, order_status,
start_date,end_date, order_sum, record_datetime)
VALUES(14,7,6,4,1,TRUNC(CURRENT_DATE+3),TRUNC(CURRENT_DATE+3),1000,CURRENT_DATE- NUMTODSINTERVAL(1,'HOUR'))
SELECT * FROM dual;